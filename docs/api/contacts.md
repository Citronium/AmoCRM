# Контакты

Ссылка на документацию:
https://www.amocrm.ru/developers/content/api/contacts

## Описание методов

| Объект                  | Описание                                                                              |
|-------------------------|---------------------------------------------------------------------------------------|
|crm.Contact              |[Множественные операции](#множественные-операции)                                      |
|contact = new crm.Contact|[Работа с объектом сделки](#работа-с-объектом-контакта)                                |
|                         |[Работа с покупателем контакта](#работа-с-покупателем-контакта)                        |
|                         |[Работа со сделками контакта](#работа-со-сделками-контакта)                            |
|                         |[Работа с компанией контакта](#работа-с-компанией-контакта)                            |
|                         |[Работа с примечаниями контакта](#работа-с-примечаниями-контакта)                      |
|                         |[Работа с задачми контакта](#работа-с-задачми-контакта)                                |
|crm.Contact.Field        |[Работа с дополнительными полями контактов](#работа-с-дополнительными-полями-контактов)|

### Множественные операции

| Метод                         | Описание                                                 |
|-------------------------------|----------------------------------------------------------|
|[find](#crmcontactfind)        |Находит контакты по заданному критерию                    |
|[findById](#crmcontactfindbyid)|Находит контакт с заданным id                             |
|[insert](#crmcontactinsert)    |Создаёт массив контактов одним запросом к CRM             |
|[update](#crmcontactupdate)    |Обновляет массив контактов одним запросом к CRM           |
|[from](#crmcontactfrom)        |Преобразует массив атрибутов в массив объектов crm.Contact|
|[new crm.Contact](#создание)   |Создаёт объект контакта                                   |

<details>
<summary>
Синонимы
</summary>

| Метод              | Описание              |
|--------------------|-----------------------|
|[of](#создание)     |Синоним new crm.Contact|
|[create](#создание) |Синоним new crm.Contact|

</details>

### Работа с объектом контакта

[Работа с атрибутами контакта](#работа-с-атрибутами-контакта)

| Метод            | Описание                                           |
|------------------|----------------------------------------------------|
|[save](#save)     |Сохраняет изменения в контакте.                     |
|[fetch](#fetch)   |Заменяет все несохранённые данные актуальными из CRM|
|[exists](#exists) |Проверяет, существует ли до сих пор контакт в CRM   |

### Работа с покупателем контакта

| Метод                                            | Описание                                        |
|--------------------------------------------------|-------------------------------------------------|
|[linkContacts](#linkcontacts)      |Прикрепляет контакты к сделке                    |
|[getContacts](#getcontacts)         |Получает список контактов, прикреплённых к сделке|
|[unlinkContacts](#unlinkcontacts)|Открепляет контакты от сделки                    |

### Работа со сделками контакта
### Работа с компанией контакта
### Работа с примечаниями контакта
### Работа с задачми контакта
### Работа с дополнительными полями контактов

## Множественные операции

### crm.Contact.find

Находит контакты по заданному критерию

```js
const contacts = await crm.Contact.find({
    // принимает все параметры, описанные в документации
    query: 'Пропущенный звонок'
});
```

### crm.Contact.findById

Находит контакт (один) с заданным id

```js
const contact = await crm.Contact.findById( 1853346 );

contact.name = 'Иван';

contact.save();
```

### crm.Contact.insert

Создаёт массив контактов одним запросом к CRM.

```js
const contact1 = new crm.Contact({
  name: 'Петр'
});

const contact2 = new crm.Contact({
  name: 'Ольга'
});

// Возвращает массив сохранённых контактов [contact1, contact2].
const contacts = await crm.Contact.insert([
  contact1,
  contact2
]);
```

Метод также может работать с обычными объектами

```js
// Возвращает массив сохранённых контактов [contact1, contact2].
const contacts = await crm.Contact.insert([
  {
    name: 'Иван'
  },
  {
    name: 'Ольга'
  }
]);
```

### crm.Contact.update

Обновляет массив контактов одним запросом к CRM.

```js
const contact1 = await crm.Contact.findById( 2381742 );
const contact2 = await crm.Contact.findById( 9735134 );

const contacts = await crm.Contact.update([
  contact1,
  contact2
]);
```

## Работа с объектом контакта

### Создание

С помощью конструктора

```js
const contact = new crm.Contact;
```

Передача начальных атрибутов

```js
const contact = new crm.Contact({
  name: 'Иван',
  responsible_user_id: '957083'
});
```

Аналогичую работу выполняют *crm.Contact.of* и *crm.Contact.create*

```js
const contact = crm.Contact.of({
  name: 'Иван',
  responsible_user_id: '957083',
});
```

```js
const contact = crm.Contact.create({
  name: 'Иван',
  responsible_user_id: '957083',
});
```

### Работа с атрибутами контакта

В любой момент времени вы можете получить или задать 
значение атрибута контакта, обращаясь к свойству
объекта:

#### Чтение

| Метод                                         | Описание                                                               |
|-----------------------------------------------|------------------------------------------------------------------------|
|contact.имя_свойства                           | Получает значение совйства                                             |
|contact.getAttribute( 'имя_свойства' )         | Аналогично contact.имя_свойства                                        |
|contact.attributes                             | Получает объект атрибутов                                              |
|contact.hasAttribute( 'имя_свойства' )         | Позволяет узнать наличие свойства у объекта                            |
|contact.isNew()                                | Проверяет, новый ли объект сделки (опирается на наличие/отсутствие id) |

```js
const contact = await crm.Contact.findById( 127311 );

console.log( contact.name ); // Получить свойство name

// Аналогично
contact.getAttribute( 'name' );

// Вернёт объект со всеми свойствами и значением всех атрибутов
console.log( contact.attributes ); 

// Проверка наличия атрибута
contact.hasAttribute( 'name' ); // true

// Проверяет, новый ли объект сделки
contact.isNew(); // false
```

#### Запись

| Метод                                             | Описание                                   |
|---------------------------------------------------|--------------------------------------------|
|contact.имя_свойства = значение                    | Задаёт значение совйства                   |
|contact.setAttribute( 'имя_свойства', 'значение' ) | Аналогично contact.имя_свойства = значение |
|contact.attributes = valuesObject                  | Задаёт объект атрибутов                    |

При изменении значений, для того, чтобы 
они сохранились в CRM, используйте метод [save](#save)

```js
const contact = await crm.Contact.findById( 127311 );
contact.name = 'Новое значение';

// Аналогично

contact.setAttribute( 'name', 'Новое значение' );

/* 
  Полностью заменит все существующие атрибуты новыми.
  Метод сохраняет существующий id объекта в CRM
*/
contact.attributes = {
  name: 'Новое значение'
}
```

#### Удаление

| Метод                                    | Описание                               |
|------------------------------------------|----------------------------------------|
| delete contact.имя_свойства              | Удаляет свойства                       |
|contact.removeAttribute( 'имя_свойства' ) | Аналогично delete contact.имя_свойства |


При изменении значений, для того, чтобы 
они сохранились в CRM, используйте метод [save](#save)

```js
const contact = await crm.Contact.findById( 127311 );

delete contact.name;

// Аналогично
contact.removeAttribute( 'name' );
```

